# todo-backend
> 가장 유명한 예제인 Todo List를 통해 __"Express를 이용한 백엔드 구현"__ 을 연습하고 __"프론트단에서의 서버와의 연결을 이해하고 실습"__ 해보는 레포.  

#### 링크 
- [프론트엔드](https://github.com/woog2roid/todo-frontend)

#### 목차
- [실행화면](#실행화면)
- [구현](#구현)

## 실행화면
- __모바일 기준 실행화면__

<img src="https://user-images.githubusercontent.com/54667577/155886412-9b71dc54-8707-4629-92a8-cd73f3ee8347.gif" alt="실행화면" width="30%" height="30%" >

## 구현
### 로그인 구현
투두리스트 프로젝트를 하면서 CRUD 기능을 모두 연습함과 동시에 가장 신경을 썼던 부분은 로그인이다. JWT 토큰을 이용하여서 로그인을 구현했는데, bcrypt와 jsonwebtoken 라이브러리를 이용하여서 로그인을 구현했다. 

프론트에서 회원가입 요청을 하며 아이디와 비밀번호를 보내면, 아이디와 암호화된 비밀번호를 DB에 저장하여 회원가입을 승인시켰다. 로그인 요청에서는 아이디와 비밀번호가 DB에 존재하는 것과 일치하는지 확인하고 JWT 토큰을 발행하여 로그인을 완료하였다. 후에 프론트엔드에서는 매 요청시에 해당 토큰을 포함시켜서 요청을 보내서 자신이 로그인 했음을 인증할 수 있었다.

### 쿠키 이슈
이 프로젝트를 하면서 기억에 남는 건 쿠키 이슈인데, 작업 환경이 컴퓨터들 마다 Chrome의 버전이 다른 군대 사지방이라는 특수한 환경이어서 더욱 해결하기가 힘들었다. 로그인이 어느 날은 유지가 되고, 또 어느 날은 안되는 것이었는데, 이는 사지방 컴퓨터의 Chrome의 버전에 따라 쿠키 관련 정책이 달라서 일어난 문제였다. 서버와 프론트에서 쿠키 관련한 로그들을 찍으며 쿠키가 제대로 전달이 안된다는 것을 알아내었고, sameSite 옵션을 설정해준 뒤에 "윈도우와 안드로이드에서는" 해결이 되었다.

아이폰에서 테스트를 하니 여전히 로그인이 되지 않는 문제가 있었고, 이는 safari와 iOS의 보안 정책이 같은 도메인끼리만 쿠키를 보낼 수 있도록 허용하고 있기 때문이었다. 이는 프론트에서 도메인으로 woog2roid.github.io를 쓰던 것을 woog2roid.dev로 변경하면서 해결되었다.

### 아쉬운 점
middlewares/jwtAuth.js에서 verifyToken만 미들웨어의 형태를 가지고, 나머지는 그냥 메서드의 개념으로 만들어 놓은 점이 조금 아쉽다. 아예 auth 관련한 util로 따로 이름을 지어 모아놓거나 아니면 발행과 삭제 기능도 미들웨어의 개념으로 만들었으면 좋았을 것 같다. 프로젝트를 거의 완성하고 위의 쿠키 이슈를 해결하는 과정에서 확인하고 구조를 바꾸어볼까 했지만, 수정을 따로 하지는 않고 남겨두었다.